{"ast":null,"code":"import _classCallCheck from\"/home/szymon/College/PUZ-Biblioteka/Admin-Panel/admin-panel/admin-panel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/szymon/College/PUZ-Biblioteka/Admin-Panel/admin-panel/admin-panel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/szymon/College/PUZ-Biblioteka/Admin-Panel/admin-panel/admin-panel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/szymon/College/PUZ-Biblioteka/Admin-Panel/admin-panel/admin-panel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import Moment from'moment';import{NavLink}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Reservation=/*#__PURE__*/function(_Component){_inherits(Reservation,_Component);var _super=_createSuper(Reservation);function Reservation(){var _this;_classCallCheck(this,Reservation);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={reservations:[],username:\"\",notFound:false,errorMessage:\"\",page:1};_this.fetchReservations=function(page,limit,username){fetch(_this.props.prefix+\"/api/library/admins/reservations?page=\".concat(page,\"&limit=\").concat(limit,\"&username=\").concat(username),{method:'GET',headers:{\"Content-Type\":\"application/json\",\"Authorization\":_this.props.getToken()}}).then(function(res){return res.json();}).then(function(res){if(res.status===404){_this.setState({notFound:true,errorMessage:res.message});}else if(res.status===403){_this.setState({notFound:true,errorMessage:\"You have to login to administrator account to get access to this resource\"});}else{_this.setState({reservations:res,notFound:false});}});};_this.confirmReservation=function(id){fetch(\"\".concat(_this.props.prefix,\"/api/library/admins/confirmBorrow/\").concat(id),{method:'POST',headers:{\"Content-Type\":\"application/json\",\"Authorization\":_this.props.getToken()}}).then(function(res){if(res.status===200){alert(\"Reservation confirmed\");var filteredArray=_this.state.reservations.filter(function(e){return e.id!==id;});_this.setState({reservations:filteredArray});}else if(res.status===400){_this.setState({notFound:true,errorMessage:\"\"});}});};_this.cancelReservation=function(id){fetch(\"\".concat(_this.props.prefix,\"/api/library/admins/reservations/cancel/\").concat(id),{method:'POST',headers:{\"Content-Type\":\"application/json\",\"Authorization\":_this.props.getToken()}}).then(function(res){if(res.status===200){alert(\"Reservation canceled\");var filteredArray=_this.state.reservations.filter(function(e){return e.id!==id;});_this.setState({reservations:filteredArray});}});};_this.usernameHandler=function(name){_this.setState({username:name.target.value});};_this.filterByUsername=function(e){e.preventDefault();_this.fetchReservations(0,10,_this.state.username);};return _this;}_createClass(Reservation,[{key:\"componentDidMount\",value:function componentDidMount(){this.fetchReservations(0,10,this.state.username);}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,reservations=_this$state.reservations,notFound=_this$state.notFound,errorMessage=_this$state.errorMessage,page=_this$state.page;if(!reservations.length&&notFound===false){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}else if(notFound===true){return/*#__PURE__*/_jsxs(\"section\",{children:[this.searchBar(),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"b\",{children:errorMessage})})]});}return/*#__PURE__*/_jsxs(\"section\",{children:[this.searchBar(),this.state.reservations.map(function(reservation,index){return/*#__PURE__*/_jsx(\"div\",{className:\"lib-card card-hover shadow-sm  p-3 mb-3 bg-white rounded\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title\",children:[\"#\",reservation.id,\". \",reservation.title]}),/*#__PURE__*/_jsx(\"h6\",{className:\"card-subtitle mb-2 text-muted\",children:Moment(reservation.dateReservation).format('YYYY-MM-DD')}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:reservation.username}),/*#__PURE__*/_jsx(NavLink,{className:\"btn btn-outline-secondary\",to:{pathname:\"/reservations/\".concat(reservation.id),query:{id:reservation.id}},children:\"Details\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-success ms-2\",onClick:function onClick(){return _this2.confirmReservation(reservation.id);},children:\"Confirm\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-warning ms-2\",onClick:function onClick(){return _this2.cancelReservation(reservation.id);},children:\"Cancel\"})]})},index);})]});}},{key:\"searchBar\",value:function searchBar(){return/*#__PURE__*/_jsxs(\"form\",{className:\"d-flex justify-content-center mb-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"p\",{className:\"center-text mx-5\",children:\"Find by username\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-auto\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"visually-hidden\",children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",placeholder:\"username\",value:this.state.username,onChange:this.usernameHandler})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:this.filterByUsername,className:\"btn btn-primary mb-3 mx-3\",children:\"Filter\"})})]});}}]);return Reservation;}(Component);export default Reservation;","map":{"version":3,"sources":["/home/szymon/College/PUZ-Biblioteka/Admin-Panel/admin-panel/admin-panel/src/components/reservations/Reservations.jsx"],"names":["React","Component","Moment","NavLink","Reservation","state","reservations","username","notFound","errorMessage","page","fetchReservations","limit","fetch","props","prefix","method","headers","getToken","then","res","json","status","setState","message","confirmReservation","id","alert","filteredArray","filter","e","cancelReservation","usernameHandler","name","target","value","filterByUsername","preventDefault","length","searchBar","map","reservation","index","title","dateReservation","format","pathname","query"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Moment from 'moment';\nimport { NavLink} from 'react-router-dom';\n\nclass Reservation extends Component {\n    state = {\n        reservations: [],\n        username: \"\",\n        notFound: false,\n        errorMessage: \"\",\n        page: 1\n     }\n\n    componentDidMount(){\n        this.fetchReservations(0, 10, this.state.username);\n    }\n     \n\n  fetchReservations = (page, limit, username) =>{\n    fetch(this.props.prefix + `/api/library/admins/reservations?page=${page}&limit=${limit}&username=${username}`, {\n       method: 'GET',\n       headers: {\"Content-Type\": \"application/json\", \"Authorization\": this.props.getToken()}\n      })\n    .then(res => res.json())\n    .then(res => {\n        if(res.status === 404){\n            this.setState({notFound: true, errorMessage: res.message});\n        }\n        else if (res.status === 403){\n            this.setState({notFound: true, errorMessage: \"You have to login to administrator account to get access to this resource\"})\n        }\n        else{\n            this.setState({reservations: res, notFound: false})\n        }       \n    })\n  }\n\n\n  confirmReservation = (id) => {\n    fetch(`${this.props.prefix}/api/library/admins/confirmBorrow/${id}`,  {\n       method: 'POST',\n       headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": this.props.getToken()\n    }\n      })\n      .then(res => {\n          if(res.status === 200){\n              alert(\"Reservation confirmed\");\n              let filteredArray = this.state.reservations.filter(e => e.id !== id);\n              this.setState({reservations: filteredArray});\n          }\n          else if (res.status === 400){\n            this.setState({notFound: true, errorMessage: \"\"})\n        }\n      });\n  }\n\n  cancelReservation = (id) => {\n    fetch(`${this.props.prefix}/api/library/admins/reservations/cancel/${id}`,  {\n       method: 'POST',\n       headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": this.props.getToken()\n    }\n      })\n      .then(res => {\n          if(res.status === 200){\n              alert(\"Reservation canceled\");\n              let filteredArray = this.state.reservations.filter(e => e.id !== id);\n              this.setState({reservations: filteredArray});\n          }\n          \n      });\n  }\n\n  usernameHandler = (name) =>{\n    this.setState({username: name.target.value});\n}   \n\n  filterByUsername = (e) =>{\n    e.preventDefault();\n    this.fetchReservations(0, 10, this.state.username);\n  }\n\n    render() { \n        const {reservations, notFound, errorMessage, page} = this.state;\n        if(!reservations.length && notFound===false){\n            return (<div>Loading...</div>)\n        }\n        else if(notFound === true){\n            return (\n                <section>\n                    {this.searchBar()}\n                    <div><b>{errorMessage}</b></div> \n                </section>\n            )\n        }\n        return ( \n            <section>\n            {this.searchBar()}            \n            {this.state.reservations.map((reservation, index) =>{\n                return(\n                <div  key={index} className=\"lib-card card-hover shadow-sm  p-3 mb-3 bg-white rounded\">\n                    <div className=\"card-body\">\n                        <h5 className=\"card-title\">#{reservation.id}. {reservation.title}</h5>\n                        <h6 className=\"card-subtitle mb-2 text-muted\">{Moment(reservation.dateReservation).format('YYYY-MM-DD')}</h6>\n                        <p className=\"card-text\">{reservation.username}</p>\n                        <NavLink className=\"btn btn-outline-secondary\" to={{pathname: `/reservations/${reservation.id}`, query: {id: reservation.id}}}>Details</NavLink>\n                        <button type=\"button\" className=\"btn btn-success ms-2\" onClick={() => this.confirmReservation(reservation.id)}>Confirm</button>                       \n                        <button type=\"button\" className=\"btn btn-warning ms-2\" onClick={() => this.cancelReservation(reservation.id)}>Cancel</button>\n                    </div>\n                </div>\n                )\n            })}\n\n\n            </section>\n         );\n    }\n\n    searchBar(){\n        return(\n            <form className=\"d-flex justify-content-center mb-5\">\n                <div className=\"col-auto\">\n                    <p className=\"center-text mx-5\">Find by username</p>\n                </div>\n                <div className=\"col-auto\">\n                    <label className=\"visually-hidden\">Username</label>\n                    <input type=\"text\" className=\"form-control\" placeholder=\"username\" value={this.state.username} onChange={this.usernameHandler}/>\n                </div>\n                <div className=\"col-auto\">\n                    <button type=\"submit\"  onClick={this.filterByUsername} className=\"btn btn-primary mb-3 mx-3\" >Filter</button>\n                </div>\n            </form>\n        )\n    }\n}\n \nexport default Reservation;"]},"metadata":{},"sourceType":"module"}